CREATE OR REPLACE VIEW OSP$PROTOCOL_DOCUMENT_STATUS AS 
    SELECT STATUS_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER
    FROM PROTOCOL_ATTACHMENT_STATUS;

CREATE OR REPLACE VIEW OSP$PROTOCOL_DOCUMENT_TYPE AS 
    SELECT t.TYPE_CD, t.DESCRIPTION, t.UPDATE_TIMESTAMP, t.UPDATE_USER, g.GROUP_CD
    FROM PROTOCOL_ATTACHMENT_TYPE t, PROTOCOL_ATTACHMENT_GROUP g, PROTOCOL_ATTACHMENT_TYPE_GROUP tg
    WHERE t.TYPE_CD = tg.TYPE_CD AND g.GROUP_CD = tg.GROUP_CD;

CREATE OR REPLACE VIEW OSP$PROTOCOL_DOCUMENTS AS 
    SELECT p.PROTOCOL_NUMBER, p.SEQUENCE_NUMBER, pap.TYPE_CD, pap.DESCRIPTION, paf.FILE_NAME, paf.FILE_DATA,
    pap.UPDATE_TIMESTAMP, pap.UPDATE_USER, pap.VERSION_NUMBER, pap.STATUS_CD, pap.DOCUMENT_ID
    FROM PROTOCOL p, PROTOCOL_ATTACHMENT_PROTOCOL pap, PROTOCOL_ATTACHMENT_FILE paf
    WHERE p.PROTOCOL_ID = pap.PROTOCOL_ID AND pap.FILE_ID = paf.PA_FILE_ID;

ALTER TABLE PROTOCOL_ATTACHMENT_PERSONNEL DROP CONSTRAINT FK_PA_PERSONNEL_FILE;

ALTER TABLE PROTOCOL_ATTACHMENT_PERSONNEL
    ADD CONSTRAINT FK_PA_PERSONNEL_FILE 
    FOREIGN KEY (FILE_ID) 
    REFERENCES PROTOCOL_ATTACHMENT_FILE (PA_FILE_ID)
    ON DELETE CASCADE;
    
ALTER TABLE PROTOCOL_ATTACHMENT_PERSONNEL
    ADD CONSTRAINT FK_PA_PERSONNEL_PROTOCOL
    FOREIGN KEY (PROTOCOL_ID)
    REFERENCES PROTOCOL (PROTOCOL_ID);

ALTER TABLE PROTOCOL_ATTACHMENT_PERSONNEL
    ADD CONSTRAINT FK_PERSON 
    FOREIGN KEY (PERSON_ID) 
    REFERENCES PROTOCOL_PERSONS (PROTOCOL_PERSON_ID);
    
ALTER TABLE PROTOCOL_ATTACHMENT_PROTOCOL DROP CONSTRAINT FK_PA_PROTOCOL_FILE;
    
ALTER TABLE PROTOCOL_ATTACHMENT_PROTOCOL
    ADD CONSTRAINT FK_PA_PROTOCOL_FILE 
    FOREIGN KEY (FILE_ID) 
    REFERENCES PROTOCOL_ATTACHMENT_FILE (PA_FILE_ID)
    ON DELETE CASCADE;

ALTER TABLE PROTOCOL_ATTACHMENT_PROTOCOL
    ADD CONSTRAINT FK_PA_PROTOCOL
    FOREIGN KEY (PROTOCOL_ID)
    REFERENCES PROTOCOL (PROTOCOL_ID);