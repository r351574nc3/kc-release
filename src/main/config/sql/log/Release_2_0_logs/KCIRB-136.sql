CREATE OR REPLACE VIEW OSP$PROTOCOL_INVESTIGATORS(
PROTOCOL_NUMBER, SEQUENCE_NUMBER, PERSON_ID, PERSON_NAME, NON_EMPLOYEE_FLAG,
PRINCIPAL_INVESTIGATOR_FLAG, AFFILIATION_TYPE_CODE, UPDATE_TIMESTAMP, UPDATE_USER)
AS SELECT PROTOCOL_NUMBER, SEQUENCE_NUMBER, 
cast(DECODE(TO_CHAR(ROLODEX_ID),NULL,PERSON_ID,TO_CHAR(ROLODEX_ID)) AS VARCHAR2(10)) PERSON_ID,
PERSON_NAME, DECODE(PERSON_ID,NULL,'Y','N') NON_EMPLOYEE_FLAG, 
DECODE(PROTOCOL_PERSON_ROLE_ID,'PI','Y','N') PRINCIPAL_INVESTIGATOR_FLAG,
AFFILIATION_TYPE_CODE, UPDATE_TIMESTAMP, UPDATE_USER
FROM PROTOCOL_PERSONS
WHERE PROTOCOL_PERSON_ROLE_ID IN ('PI','COI');


CREATE OR REPLACE VIEW OSP$PROTOCOL_KEY_PERSONS
(PROTOCOL_NUMBER, SEQUENCE_NUMBER, PERSON_ID, PERSON_NAME, PERSON_ROLE,
NON_EMPLOYEE_FLAG, AFFILIATION_TYPE_CODE, UPDATE_TIMESTAMP, UPDATE_USER)
AS 
SELECT
PROTOCOL_NUMBER, SEQUENCE_NUMBER,
DECODE(PERSON_ID,NULL,TO_CHAR(ROLODEX_ID),PERSON_ID) PERSON_ID, 
PERSON_NAME, B.DESCRIPTION PERSON_ROLE,
DECODE(PERSON_ID,NULL,'N','Y') NON_EMPLOYEE_FLAG, 
AFFILIATION_TYPE_CODE, A.UPDATE_TIMESTAMP UPDATE_TIMESTAMP, A.UPDATE_USER UPDATE_USER
FROM PROTOCOL_PERSONS A, PROTOCOL_PERSON_ROLES B 
WHERE B.PROTOCOL_PERSON_ROLE_ID = A.PROTOCOL_PERSON_ROLE_ID AND
A.PROTOCOL_PERSON_ROLE_ID NOT IN ('PI','COI');


INSERT INTO PROTOCOL_PERSON_ROLE_MAPPING ( ROLE_MAPPING_ID, SOURCE_ROLE_ID, TARGET_ROLE_ID, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID ) 
VALUES ( 1, 'PI', 'COI', sysdate, user, 1, 'F9CBAA4058814FDAAE85F9567B84F8BB' ); 
INSERT INTO PROTOCOL_PERSON_ROLE_MAPPING ( ROLE_MAPPING_ID, SOURCE_ROLE_ID, TARGET_ROLE_ID, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID ) 
VALUES ( 2, 'COI', 'PI', sysdate, user, 1, 'D8FF86A02CA142D59FD6F92A71B0F5D1' ); 
INSERT INTO PROTOCOL_PERSON_ROLE_MAPPING ( ROLE_MAPPING_ID, SOURCE_ROLE_ID, TARGET_ROLE_ID, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID ) 
VALUES ( 3, 'SP', 'CA', sysdate, user, 1, '247759D7176C460594532CE5A9A3A468' ); 
INSERT INTO PROTOCOL_PERSON_ROLE_MAPPING ( ROLE_MAPPING_ID, SOURCE_ROLE_ID, TARGET_ROLE_ID, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID ) 
VALUES ( 4, 'SP', 'CRC', sysdate, user, 1, '4AB7E5FAB42349E98C57E8C13B3C4265' ); 
INSERT INTO PROTOCOL_PERSON_ROLE_MAPPING ( ROLE_MAPPING_ID, SOURCE_ROLE_ID, TARGET_ROLE_ID, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID ) 
VALUES ( 5, 'CA', 'SP', sysdate, user, 1, '822556F26DA94072A2487ED94FEE0E06' ); 
INSERT INTO PROTOCOL_PERSON_ROLE_MAPPING ( ROLE_MAPPING_ID, SOURCE_ROLE_ID, TARGET_ROLE_ID, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID ) 
VALUES ( 6, 'CA', 'CRC', sysdate, user, 1, '83DBA44EDC3A4E94B55C4D133D7D169E' ); 
INSERT INTO PROTOCOL_PERSON_ROLE_MAPPING ( ROLE_MAPPING_ID, SOURCE_ROLE_ID, TARGET_ROLE_ID, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID ) 
VALUES ( 7, 'CRC', 'SP', sysdate, user, 1, 'F23CACD24BCF4BC9BEA6D0CB92C43EC6' ); 
INSERT INTO PROTOCOL_PERSON_ROLE_MAPPING ( ROLE_MAPPING_ID, SOURCE_ROLE_ID, TARGET_ROLE_ID, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID ) 
VALUES ( 8, 'CRC', 'CA', sysdate, user, 1, 'C4307C73DD594F8BBE2B3CC6949FABA7' ); 

commit;
