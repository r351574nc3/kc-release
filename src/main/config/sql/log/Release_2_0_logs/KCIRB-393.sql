/* PROTOCOL_SUBMISSION_DOC */

CREATE TABLE PROTOCOL_SUBMISSION_DOC (
    SUBMISSION_DOC_ID          NUMBER(12) NOT NULL,
    PROTOCOL_NUMBER            VARCHAR2(20) NOT NULL,
    SEQUENCE_NUMBER            NUMBER(4) NOT NULL,
    SUBMISSION_NUMBER          NUMBER(4) NOT NULL,
    PROTOCOL_ID                NUMBER(12,0) NOT NULL,
    SUBMISSION_ID_FK           NUMBER(12,0) NOT NULL,
    DOCUMENT_ID                NUMBER(3) NOT NULL,
    FILE_NAME                  VARCHAR2(300),
    DOCUMENT                   BLOB,
    UPDATE_TIMESTAMP           DATE,
    UPDATE_USER                VARCHAR2(60),
    VER_NBR                    NUMBER(8,0) DEFAULT 1 NOT NULL,
    OBJ_ID                     VARCHAR2(36) DEFAULT SYS_GUID() NOT NULL);

ALTER TABLE PROTOCOL_SUBMISSION_DOC
ADD CONSTRAINT PK_PROTOCOL_SUBMISSION_DOC
PRIMARY KEY (SUBMISSION_DOC_ID);

ALTER TABLE PROTOCOL_SUBMISSION_DOC
ADD CONSTRAINT FK_PROTOCOL_SUBMISSION_DOC1
FOREIGN KEY (PROTOCOL_ID) 
REFERENCES PROTOCOL (PROTOCOL_ID);

ALTER TABLE PROTOCOL_SUBMISSION_DOC
ADD CONSTRAINT FK_PROTOCOL_SUBMISSION_DOC2
FOREIGN KEY (SUBMISSION_ID_FK) 
REFERENCES PROTOCOL_SUBMISSION (SUBMISSION_ID);

CREATE or REPLACE VIEW OSP$PROTOCOL_SUBMISSION_DOC AS SELECT
    PROTOCOL_NUMBER,
    SEQUENCE_NUMBER,
    SUBMISSION_NUMBER,
    DOCUMENT_ID,
    FILE_NAME,
    DOCUMENT,
    UPDATE_TIMESTAMP,
    UPDATE_USER
FROM PROTOCOL_SUBMISSION_DOC;

COMMIT;
