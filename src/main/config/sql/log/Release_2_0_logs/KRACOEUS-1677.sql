
  CREATE TABLE BUDGET_SUB_AWARD_FILES 
   (	PROPOSAL_NUMBER VARCHAR2(12 BYTE) NOT NULL ENABLE, 
	VERSION_NUMBER NUMBER(3,0) NOT NULL ENABLE, 
	SUB_AWARD_NUMBER NUMBER(3,0) NOT NULL ENABLE, 
	SUB_AWARD_XFD_FILE BLOB DEFAULT empty_blob(), 
	SUB_AWARD_XFD_FILE_NAME VARCHAR2(256 BYTE) NOT NULL ENABLE, 
	SUB_AWARD_XML_FILE CLOB DEFAULT empty_clob(), 
	UPDATE_TIMESTAMP DATE NOT NULL ENABLE, 
	UPDATE_USER VARCHAR2(60 BYTE) NOT NULL ENABLE, 
	VER_NBR NUMBER(8,0) DEFAULT 1 NOT NULL ENABLE, 
	OBJ_ID VARCHAR2(36 BYTE) DEFAULT SYS_GUID() NOT NULL ENABLE, 
	 CONSTRAINT PK_BUDGET_SUB_AWARD_FILES_KRA PRIMARY KEY (PROPOSAL_NUMBER, VERSION_NUMBER, SUB_AWARD_NUMBER)
   );
	ALTER table BUDGET_SUB_AWARD_FILES add
	 CONSTRAINT KRA_BUDGET_SUB_AWARDS_FK1 FOREIGN KEY (PROPOSAL_NUMBER, VERSION_NUMBER, SUB_AWARD_NUMBER)
	  REFERENCES BUDGET_SUB_AWARDS (PROPOSAL_NUMBER, VERSION_NUMBER, SUB_AWARD_NUMBER) ON DELETE CASCADE ENABLE;

	ALTER table BUDGET_SUB_AWARD_ATT add
	 CONSTRAINT KRA_BUDGET_SUB_AWARD_ATT_FK1 FOREIGN KEY (PROPOSAL_NUMBER, VERSION_NUMBER, SUB_AWARD_NUMBER)
	  REFERENCES BUDGET_SUB_AWARDS (PROPOSAL_NUMBER, VERSION_NUMBER, SUB_AWARD_NUMBER) ON DELETE CASCADE ENABLE;


create or replace view OSP$BUDGET_SUB_AWARDS as 
	select A.PROPOSAL_NUMBER,A.VERSION_NUMBER,A.SUB_AWARD_NUMBER,ORGANIZATION_NAME,
				SUB_AWARD_STATUS_CODE,B.SUB_AWARD_XFD_FILE SUB_AWARD_XFD_FILE,A.SUB_AWARD_XFD_FILE_NAME,
				A.COMMENTS,A.XFD_UPDATE_USER,A.XFD_UPDATE_TIMESTAMP,B.SUB_AWARD_XML_FILE SUB_AWARD_XML_FILE,
				A.TRANSLATION_COMMENTS,A.XML_UPDATE_USER,A.XML_UPDATE_TIMESTAMP,A.UPDATE_TIMESTAMP,A.UPDATE_USER	
	from BUDGET_SUB_AWARDS A,BUDGET_SUB_AWARD_FILES B
	where A.PROPOSAL_NUMBER = B.PROPOSAL_NUMBER 
			and A.VERSION_NUMBER = B.VERSION_NUMBER
			and A.SUB_AWARD_NUMBER = B.SUB_AWARD_NUMBER(+);


