ALTER TABLE PROTOCOL_ATTACHMENT_PERSONNEL DROP CONSTRAINT FK_PA_PERSONNEL_FILE;
ALTER TABLE PROTOCOL_ATTACHMENT_PROTOCOL DROP CONSTRAINT FK_PA_PROTOCOL_FILE;

DROP TABLE PROTOCOL_ATTACHMENT_FILE;

CREATE TABLE ATTACHMENT_FILE
   (FILE_ID NUMBER NOT NULL ENABLE, 
    SEQUENCE_NUMBER NUMBER(4,0) NOT NULL ENABLE,
    FILE_NAME VARCHAR2(150) NOT NULL ENABLE,
    CONTENT_TYPE VARCHAR2(250) NOT NULL ENABLE,
    FILE_DATA BLOB NOT NULL ENABLE, 
    VER_NBR NUMBER(8,0) DEFAULT 1 NOT NULL,
    OBJ_ID VARCHAR2(36) DEFAULT SYS_GUID()  NOT NULL,
    UPDATE_TIMESTAMP DATE NOT NULL,
    UPDATE_USER VARCHAR2(10) NOT NULL);

ALTER TABLE ATTACHMENT_FILE
    ADD CONSTRAINT PK_ATTACHMENT_FILE
    PRIMARY KEY (FILE_ID);

CREATE SEQUENCE SEQ_ATTACHMENT_ID INCREMENT BY 1 START WITH 1 NOCACHE;

CREATE TABLE AWARD_ATTACHMENT_TYPE
   (TYPE_CODE VARCHAR2(3) NOT NULL ENABLE,
    DESCRIPTION VARCHAR2(300) NOT NULL ENABLE,
    VER_NBR NUMBER(8,0) DEFAULT 1 NOT NULL ENABLE,
    OBJ_ID VARCHAR2(36) DEFAULT SYS_GUID() NOT NULL ENABLE,
    UPDATE_TIMESTAMP DATE NOT NULL ENABLE,
    UPDATE_USER VARCHAR2(10) NOT NULL ENABLE);

ALTER TABLE AWARD_ATTACHMENT_TYPE
    ADD CONSTRAINT PK_AWARD_ATTACHMENT_TYPE
    PRIMARY KEY (TYPE_CODE);

INSERT INTO AWARD_ATTACHMENT_TYPE(TYPE_CODE, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 1, 'Notice of Award', sysdate, user ); 
INSERT INTO AWARD_ATTACHMENT_TYPE(TYPE_CODE, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 2, 'Award Modification', sysdate, user ); 
INSERT INTO AWARD_ATTACHMENT_TYPE(TYPE_CODE, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 3, 'Bogus Entry', sysdate, user ); 
INSERT INTO AWARD_ATTACHMENT_TYPE(TYPE_CODE, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 4, 'Bogus Entry 2', sysdate, user ); 

CREATE TABLE AWARD_ATTACHMENT
   (AWARD_ATTACHMENT_ID NUMBER(12,0) NOT NULL ENABLE,
    AWARD_ID NUMBER(12,0) NOT NULL, 
    AWARD_NUMBER VARCHAR2(20) NOT NULL, 
    SEQUENCE_NUMBER NUMBER(4,0) NOT NULL ENABLE,
    TYPE_CODE VARCHAR2(3) NOT NULL ENABLE,
    DOCUMENT_ID NUMBER(4,0) NOT NULL ENABLE,
    FILE_ID NUMBER(12,0) NOT NULL ENABLE,
    DESCRIPTION VARCHAR2(200), 
    VER_NBR NUMBER(8,0) DEFAULT 1 NOT NULL ENABLE,
    OBJ_ID VARCHAR2(36) DEFAULT SYS_GUID()  NOT NULL ENABLE,
    UPDATE_TIMESTAMP DATE NOT NULL ENABLE,
    UPDATE_USER VARCHAR2(10) NOT NULL ENABLE);

ALTER TABLE AWARD_ATTACHMENT
    ADD CONSTRAINT PK_AWARD_ATTACHMENT
    PRIMARY KEY (AWARD_ATTACHMENT_ID);

ALTER TABLE AWARD_ATTACHMENT
    ADD CONSTRAINT FK_ATTACHMENT_FILE 
    FOREIGN KEY (FILE_ID) 
    REFERENCES ATTACHMENT_FILE (FILE_ID)
    ON DELETE CASCADE;
    
ALTER TABLE AWARD_ATTACHMENT
    ADD CONSTRAINT FK_AWARD_ATTACHMENT_TYPE 
    FOREIGN KEY (TYPE_CODE) 
    REFERENCES AWARD_ATTACHMENT_TYPE (TYPE_CODE);

ALTER TABLE AWARD_ATTACHMENT
	ADD CONSTRAINT FK_AW_ATT_AWARD 
	FOREIGN KEY (AWARD_ID) 
	REFERENCES AWARD (AWARD_ID);

CREATE SEQUENCE SEQ_AWARD_ATTACHMENT_ID INCREMENT BY 1 START WITH 1 NOCACHE;

ALTER TABLE PROTOCOL_ATTACHMENT_PERSONNEL
    ADD CONSTRAINT FK_PA_PERSONNEL_FILE 
    FOREIGN KEY (FILE_ID) 
    REFERENCES ATTACHMENT_FILE (FILE_ID)
    ON DELETE CASCADE;

ALTER TABLE PROTOCOL_ATTACHMENT_PROTOCOL
    ADD CONSTRAINT FK_PA_PROTOCOL_FILE 
    FOREIGN KEY (FILE_ID) 
    REFERENCES ATTACHMENT_FILE (FILE_ID)
    ON DELETE CASCADE;

commit;