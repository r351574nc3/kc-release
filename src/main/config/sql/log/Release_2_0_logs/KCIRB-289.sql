CREATE TABLE PROTOCOL_ATTACHMENT_TYPE
   (TYPE_CD VARCHAR2(3) NOT NULL ENABLE,
    DESCRIPTION VARCHAR2(300) NOT NULL ENABLE,
    VER_NBR NUMBER(8,0) DEFAULT 1 NOT NULL ENABLE,
    OBJ_ID VARCHAR2(36) DEFAULT SYS_GUID() NOT NULL ENABLE,
    UPDATE_TIMESTAMP DATE NOT NULL ENABLE,
    UPDATE_USER VARCHAR2(10) NOT NULL ENABLE);

ALTER TABLE PROTOCOL_ATTACHMENT_TYPE
    ADD CONSTRAINT PK_PROTOCOL_ATTACHMENT_TYPE
    PRIMARY KEY (TYPE_CD);

CREATE TABLE PROTOCOL_ATTACHMENT_GROUP
   (GROUP_CD VARCHAR2(3) NOT NULL ENABLE,
    DESCRIPTION VARCHAR2(300) NOT NULL ENABLE, 
    VER_NBR NUMBER(8,0) DEFAULT 1 NOT NULL ENABLE,
    OBJ_ID VARCHAR2(36) DEFAULT SYS_GUID()  NOT NULL ENABLE,
    UPDATE_TIMESTAMP DATE NOT NULL ENABLE,
    UPDATE_USER VARCHAR2(10) NOT NULL ENABLE);

ALTER TABLE PROTOCOL_ATTACHMENT_GROUP
    ADD CONSTRAINT PK_PROTOCOL_ATTACHMENT_GROUP
    PRIMARY KEY (GROUP_CD);

CREATE TABLE PROTOCOL_ATTACHMENT_TYPE_GROUP
   (TYPE_GROUP_ID NUMBER(12,0) NOT NULL ENABLE, 
    TYPE_CD VARCHAR2(3) NOT NULL ENABLE,
    GROUP_CD VARCHAR2(3) NOT NULL ENABLE,
    VER_NBR NUMBER(8,0) DEFAULT 1 NOT NULL ENABLE,
    OBJ_ID VARCHAR2(36) DEFAULT SYS_GUID() NOT NULL ENABLE,
    UPDATE_TIMESTAMP DATE NOT NULL ENABLE,
    UPDATE_USER VARCHAR2(10) NOT NULL ENABLE);

ALTER TABLE PROTOCOL_ATTACHMENT_TYPE_GROUP
    ADD CONSTRAINT PK_PROTOCOL_ATTACH_TYPE_GROUP
    PRIMARY KEY (TYPE_GROUP_ID);

ALTER TABLE PROTOCOL_ATTACHMENT_TYPE_GROUP
    ADD CONSTRAINT FK_PROTOCOL_ATTACH_TG_TYPE 
    FOREIGN KEY (TYPE_CD) 
    REFERENCES PROTOCOL_ATTACHMENT_TYPE (TYPE_CD);

ALTER TABLE PROTOCOL_ATTACHMENT_TYPE_GROUP
    ADD CONSTRAINT FK_PROTOCOL_ATTACH_TG_GROUP 
    FOREIGN KEY (GROUP_CD) 
    REFERENCES PROTOCOL_ATTACHMENT_GROUP (GROUP_CD);

CREATE TABLE PROTOCOL_ATTACHMENT_STATUS
   (STATUS_CD VARCHAR2(3) NOT NULL ENABLE,
    DESCRIPTION VARCHAR2(300) NOT NULL ENABLE,
    VER_NBR NUMBER(8,0) DEFAULT 1 NOT NULL ENABLE,
    OBJ_ID VARCHAR2(36) DEFAULT SYS_GUID() NOT NULL ENABLE,
    UPDATE_TIMESTAMP DATE NOT NULL ENABLE,
    UPDATE_USER VARCHAR2(10) NOT NULL ENABLE);

ALTER TABLE PROTOCOL_ATTACHMENT_STATUS
    ADD CONSTRAINT PK_PROTOCOL_ATTACHMENT_STATUS
    PRIMARY KEY (STATUS_CD);

ALTER TABLE PROTOCOL_ATTACHMENT_STATUS
    ADD CONSTRAINT UQ_PA_STATUS 
    UNIQUE (DESCRIPTION);

CREATE TABLE PROTOCOL_ATTACHMENT_FILE
   (PA_FILE_ID NUMBER NOT NULL ENABLE, 
    FILE_NAME VARCHAR2(150) NOT NULL ENABLE,
    CONTENT_TYPE VARCHAR2(250) NOT NULL ENABLE,
    FILE_DATA BLOB NOT NULL ENABLE, 
    VER_NBR NUMBER(8,0) DEFAULT 1 NOT NULL,
    OBJ_ID VARCHAR2(36) DEFAULT SYS_GUID()  NOT NULL,
    UPDATE_TIMESTAMP DATE NOT NULL,
    UPDATE_USER VARCHAR2(10) NOT NULL);

ALTER TABLE PROTOCOL_ATTACHMENT_FILE
    ADD CONSTRAINT PK_PROTOCOL_ATTACHMENT_FILE
    PRIMARY KEY (PA_FILE_ID);

CREATE TABLE PROTOCOL_ATTACHMENT_PROTOCOL
   (PA_PROTOCOL_ID NUMBER(12,0) NOT NULL ENABLE, 
    PROTOCOL_ID NUMBER(12,0) NOT NULL ENABLE,
    TYPE_CD VARCHAR2(3) NOT NULL ENABLE,
    VERSION_NUMBER NUMBER(3,0) NOT NULL ENABLE,
    DOCUMENT_ID NUMBER(4,0) NOT NULL ENABLE,
    FILE_ID NUMBER(12,0) NOT NULL ENABLE,
    DESCRIPTION VARCHAR2(300) NOT NULL ENABLE, 
    STATUS_CD VARCHAR2(3) NOT NULL ENABLE,
    CONTACT_NAME VARCHAR2(30),
    EMAIL_ADDRESS VARCHAR2(60),
    PHONE_NUMBER VARCHAR2(20),
    COMMENTS VARCHAR2(300),
    VER_NBR NUMBER(8,0) DEFAULT 1 NOT NULL ENABLE,
    OBJ_ID VARCHAR2(36) DEFAULT SYS_GUID()  NOT NULL ENABLE,
    UPDATE_TIMESTAMP DATE NOT NULL ENABLE,
    UPDATE_USER VARCHAR2(10) NOT NULL ENABLE);

ALTER TABLE PROTOCOL_ATTACHMENT_PROTOCOL
    ADD CONSTRAINT PK_PROTOCOL_ATTACH_PROTOCOL
    PRIMARY KEY (PA_PROTOCOL_ID);

ALTER TABLE PROTOCOL_ATTACHMENT_PROTOCOL
    ADD CONSTRAINT FK_PA_PROTOCOL_FILE 
    FOREIGN KEY (FILE_ID) 
    REFERENCES PROTOCOL_ATTACHMENT_FILE (PA_FILE_ID);

--ALTER TABLE PROTOCOL_ATTACHMENT_PROTOCOL
--    ADD CONSTRAINT FK_PA_PROTOCOL
--    FOREIGN KEY (PROTOCOL_ID)
--    REFERENCES PROTOCOL (PROTOCOL_ID);
--commit;

ALTER TABLE PROTOCOL_ATTACHMENT_PROTOCOL
    ADD CONSTRAINT FK_PROTOCOL_ATTACHMENT_TYPE 
    FOREIGN KEY (TYPE_CD) 
    REFERENCES PROTOCOL_ATTACHMENT_TYPE (TYPE_CD);

ALTER TABLE PROTOCOL_ATTACHMENT_PROTOCOL
    ADD CONSTRAINT FK_PROTOCOL_ATTACH_STATUS 
    FOREIGN KEY (STATUS_CD) 
    REFERENCES PROTOCOL_ATTACHMENT_STATUS (STATUS_CD);

ALTER TABLE PROTOCOL_ATTACHMENT_PROTOCOL 
    ADD CONSTRAINT UQ_PA_PROTOCOL 
    UNIQUE (PROTOCOL_ID, TYPE_CD, VERSION_NUMBER, DOCUMENT_ID);

CREATE TABLE PROTOCOL_ATTACHMENT_PERSONNEL
   (PA_PERSONNEL_ID NUMBER(12,0) NOT NULL ENABLE, 
    PROTOCOL_ID NUMBER(12,0) NOT NULL ENABLE,
    TYPE_CD VARCHAR2(3) NOT NULL ENABLE,
    VERSION_NUMBER NUMBER(3,0) NOT NULL ENABLE,
    DOCUMENT_ID NUMBER(4,0) NOT NULL ENABLE,
    FILE_ID NUMBER(12,0) NOT NULL ENABLE,
    DESCRIPTION VARCHAR2(300) NOT NULL ENABLE, 
    PERSON_ID NUMBER(12,0) NOT NULL ENABLE,
    VER_NBR NUMBER(8,0) DEFAULT 1 NOT NULL ENABLE,
    OBJ_ID VARCHAR2(36) DEFAULT SYS_GUID()  NOT NULL ENABLE,
    UPDATE_TIMESTAMP DATE NOT NULL ENABLE,
    UPDATE_USER VARCHAR2(10) NOT NULL ENABLE);

ALTER TABLE PROTOCOL_ATTACHMENT_PERSONNEL
    ADD CONSTRAINT PK_PROTOCOL_ATTACH_PERSONNEL
    PRIMARY KEY (PA_PERSONNEL_ID);

ALTER TABLE PROTOCOL_ATTACHMENT_PERSONNEL
    ADD CONSTRAINT FK_PA_PERSONNEL_FILE 
    FOREIGN KEY (FILE_ID) 
    REFERENCES PROTOCOL_ATTACHMENT_FILE (PA_FILE_ID);

--ALTER TABLE PROTOCOL_ATTACHMENT_PERSONNEL
--    ADD CONSTRAINT FK_PA_PERSONNEL_PROTOCOL
--    FOREIGN KEY (PROTOCOL_ID)
--    REFERENCES PROTOCOL (PROTOCOL_ID);
--commit;

--ALTER TABLE PROTOCOL_ATTACHMENT_PERSONNEL
--    ADD CONSTRAINT FK_PERSON 
--    FOREIGN KEY (PERSON_ID) 
--    REFERENCES PERSON (PERSON_ID);
--commit;

ALTER TABLE PROTOCOL_ATTACHMENT_PERSONNEL
    ADD CONSTRAINT UQ_PA_PERSONNEL 
    UNIQUE (PROTOCOL_ID, TYPE_CD, VERSION_NUMBER, DOCUMENT_ID);

INSERT INTO PROTOCOL_ATTACHMENT_TYPE ( TYPE_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 1, 'Informed Consent Document', sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_TYPE ( TYPE_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 2, 'Recruitment Brochure', sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_TYPE ( TYPE_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 3, 'Advertisement', sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_TYPE ( TYPE_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 4, 'Protocol Narrative', sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_TYPE ( TYPE_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 5, 'Investigator Brochure', sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_TYPE ( TYPE_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 6, 'Children''s Assent Form', sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_TYPE ( TYPE_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 7, 'HIPAA Research Authorization Form', sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_TYPE ( TYPE_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 8, 'HIPAA Waiver of Research Authorization Form', sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_TYPE ( TYPE_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 9, 'Other Protocol Attachment', sysdate, user );
commit;

INSERT INTO PROTOCOL_ATTACHMENT_GROUP ( GROUP_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 1, 'Protocol Attachments', sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_GROUP ( GROUP_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 2, 'Personnel Attachments', sysdate, user );
commit;

INSERT INTO PROTOCOL_ATTACHMENT_TYPE_GROUP ( TYPE_GROUP_ID, TYPE_CD, GROUP_CD, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 1, 1, 1, sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_TYPE_GROUP ( TYPE_GROUP_ID, TYPE_CD, GROUP_CD, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 2, 2, 1, sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_TYPE_GROUP ( TYPE_GROUP_ID, TYPE_CD, GROUP_CD, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 3, 3, 1, sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_TYPE_GROUP ( TYPE_GROUP_ID, TYPE_CD, GROUP_CD, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 4, 4, 1, sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_TYPE_GROUP ( TYPE_GROUP_ID, TYPE_CD, GROUP_CD, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 5, 5, 1, sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_TYPE_GROUP ( TYPE_GROUP_ID, TYPE_CD, GROUP_CD, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 6, 6, 1, sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_TYPE_GROUP ( TYPE_GROUP_ID, TYPE_CD, GROUP_CD, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 7, 7, 1, sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_TYPE_GROUP ( TYPE_GROUP_ID, TYPE_CD, GROUP_CD, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 8, 8, 1, sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_TYPE_GROUP ( TYPE_GROUP_ID, TYPE_CD, GROUP_CD, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 9, 9, 1, sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_TYPE_GROUP ( TYPE_GROUP_ID, TYPE_CD, GROUP_CD, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 10, 9, 2, sysdate, user );
commit;

INSERT INTO PROTOCOL_ATTACHMENT_STATUS ( STATUS_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 1, 'Draft', sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_STATUS ( STATUS_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 2, 'Finalized', sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_STATUS ( STATUS_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 3, 'Deleted', sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_STATUS ( STATUS_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 4, 'Superceded', sysdate, user ); 
INSERT INTO PROTOCOL_ATTACHMENT_STATUS ( STATUS_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER ) 
VALUES ( 5, 'Expired', sysdate, user ); 
commit;