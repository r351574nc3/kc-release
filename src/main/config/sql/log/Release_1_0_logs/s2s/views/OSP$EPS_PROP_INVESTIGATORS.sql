
CREATE OR REPLACE VIEW osp$eps_prop_investigators ( 
 	   PROPOSAL_NUMBER, PERSON_ID, PERSON_NAME, PRINCIPAL_INVESTIGATOR_FLAG, FACULTY_FLAG, 
	   NON_MIT_PERSON_FLAG, CONFLICT_OF_INTEREST_FLAG, PERCENTAGE_EFFORT, FEDR_DEBR_FLAG, FEDR_DELQ_FLAG, 
	   UPDATE_TIMESTAMP, UPDATE_USER,MULTI_PI_FLAG) 
	   AS select 
	   PROPOSAL_NUMBER, cast(decode(to_char(ROLODEX_ID),null,PERSON_ID,to_char(ROLODEX_ID)) as varchar2(10)) PERSON_ID, FULL_NAME, 
	   decode(PROP_PERSON_ROLE_ID,'PI','Y','N') PRINCIPAL_INVESTIGATOR_FLAG, IS_FACULTY, 
	   decode(PERSON_ID,null,'Y','N') NON_MIT_PERSON_FLAG,CONFLICT_OF_INTEREST_FLAG, PERCENTAGE_EFFORT, 
	   FEDR_DEBR_FLAG, FEDR_DELQ_FLAG, UPDATE_TIMESTAMP, UPDATE_USER,
	   (select decode(count(PERSON_ID),0,'N','Y') MULTI_PI_FLAG 
	   			from EPS_PROP_PERSON A WHERE A.PROPOSAL_NUMBER = B.PROPOSAL_NUMBER and
	   									PROP_PERSON_ROLE_ID in ('COI')) MULTI_PI_FLAG 
	from EPS_PROP_PERSON B WHERE PROP_PERSON_ROLE_ID in ('PI','COI');
