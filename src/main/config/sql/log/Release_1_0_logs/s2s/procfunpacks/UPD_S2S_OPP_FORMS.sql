CREATE OR REPLACE PROCEDURE UPD_S2S_OPP_FORMS (
	   AV_PROPOSAL_NUMBER 		  	IN	OSP$S2S_OPP_FORMS.PROPOSAL_NUMBER%TYPE :=NULL,
  	   AV_OPP_NAME_SPACE    		IN	OSP$S2S_OPP_FORMS.OPP_NAME_SPACE%TYPE :=NULL,
  	   AV_FORM_NAME         		IN	OSP$S2S_OPP_FORMS.FORM_NAME%TYPE :=NULL,
  	   AV_MANDATORY         		IN	OSP$S2S_OPP_FORMS.MANDATORY%TYPE :=NULL,
  	   AV_AVAILABLE         		IN	OSP$S2S_OPP_FORMS.AVAILABLE%TYPE :=NULL,
  	   AV_INCLUDE           		IN	OSP$S2S_OPP_FORMS.INCLUDE%TYPE :=NULL,
  	   AV_UPDATE_TIMESTAMP  		IN	OSP$S2S_OPP_FORMS.UPDATE_TIMESTAMP%TYPE :=NULL,
  	   AV_UPDATE_USER       		IN	OSP$S2S_OPP_FORMS.UPDATE_USER%TYPE :=NULL,
	   AW_OPP_NAME_SPACE 		  	IN	OSP$S2S_OPP_FORMS.OPP_NAME_SPACE%TYPE :=NULL,
  	   AW_UPDATE_TIMESTAMP  		IN	OSP$S2S_OPP_FORMS.UPDATE_TIMESTAMP%TYPE :=NULL,
	   AC_TYPE IN CHAR )
IS
    DATA_CHANGED    EXCEPTION;
BEGIN
  IF AC_TYPE = 'I' THEN
    INSERT INTO OSP$S2S_OPP_FORMS (
		   PROPOSAL_NUMBER,
		   OPP_NAME_SPACE,
  		   FORM_NAME,
		   MANDATORY,
		   AVAILABLE,
		   INCLUDE,
		   UPDATE_TIMESTAMP,
  		   UPDATE_USER)
    VALUES (
		AV_PROPOSAL_NUMBER,
		AV_OPP_NAME_SPACE,
		AV_FORM_NAME,
		AV_MANDATORY,
		AV_AVAILABLE,
		AV_INCLUDE,
		AV_UPDATE_TIMESTAMP,
		AV_UPDATE_USER) ;
  ELSIF AC_TYPE = 'U' THEN
    UPDATE OSP$S2S_OPP_FORMS SET
		   PROPOSAL_NUMBER = AV_PROPOSAL_NUMBER,
		   OPP_NAME_SPACE = AV_OPP_NAME_SPACE,
  		   FORM_NAME = AV_FORM_NAME,
		   MANDATORY = AV_MANDATORY,
		   AVAILABLE = AV_AVAILABLE,
		   INCLUDE = AV_INCLUDE,
		   UPDATE_TIMESTAMP = AV_UPDATE_TIMESTAMP,
  		   UPDATE_USER = AV_UPDATE_USER
    WHERE
	  PROPOSAL_NUMBER = AV_PROPOSAL_NUMBER AND
      OPP_NAME_SPACE = AW_OPP_NAME_SPACE; 
--      UPDATE_TIMESTAMP = AW_UPDATE_TIMESTAMP ;
    IF SQL%NOTFOUND THEN
      RAISE DATA_CHANGED;
    END IF;
  END IF;
EXCEPTION
  WHEN DATA_CHANGED THEN
    RAISE_APPLICATION_ERROR(-20100, 'DATA CHANGED BETWEEN RETRIEVE AND UPDATE');
END;
/

