CREATE TABLE PROTOCOL_ONLN_RVW_STATUS (
	STATUS_CODE VARCHAR(3) NOT NULL,
	DESCRIPTION VARCHAR(200) NOT NULL,
	UPDATE_TIMESTAMP DATE NOT NULL,
	UPDATE_USER VARCHAR(60) NOT NULL,
	VER_NBR DECIMAL(8) NOT NULL,
	OBJ_ID VARCHAR(36) NOT NULL	
);

ALTER TABLE PROTOCOL_ONLN_RVW_STATUS ADD CONSTRAINT PK_PROTOCOL_ONLN_RVW_STATUS PRIMARY KEY ( STATUS_CODE );

INSERT INTO PROTOCOL_ONLN_RVW_STATUS ( STATUS_CODE, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID )
VALUES ( 'F', 'FINAL', SYSDATE, 'kr', 1, SYS_GUID() );

INSERT INTO PROTOCOL_ONLN_RVW_STATUS ( STATUS_CODE, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID )
VALUES ( 'S', 'SAVED', SYSDATE, 'kr', 1, SYS_GUID() );

-- DROP TABLE PROTOCOL_REVIEW_DETERM_RECOM
CREATE TABLE PROTOCOL_ONLN_RVW_DETERM_RECOM (
	REVIEW_DETERM_RECOM_CD NUMBER( 3, 0 ) NOT NULL,
	DESCRIPTION VARCHAR(200) NOT NULL,
	UPDATE_TIMESTAMP DATE NOT NULL,
	UPDATE_USER VARCHAR(60) NOT NULL,
	VER_NBR DECIMAL(8) NOT NULL,
	OBJ_ID VARCHAR(36) NOT NULL	
);

ALTER TABLE PROTOCOL_ONLN_RVW_DETERM_RECOM ADD CONSTRAINT PK_ONLN_RVW_DETERM_RECOM PRIMARY KEY ( REVIEW_DETERM_RECOM_CD );

INSERT INTO PROTOCOL_ONLN_RVW_DETERM_RECOM ( REVIEW_DETERM_RECOM_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID )
VALUES ( 1, 'Substantive Revisions Required', SYSDATE, 'kr', 1, SYS_GUID() );
INSERT INTO PROTOCOL_ONLN_RVW_DETERM_RECOM ( REVIEW_DETERM_RECOM_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID )
VALUES ( 2, 'Specific Minor Revisions', SYSDATE, 'kr', 1, SYS_GUID() );
INSERT INTO PROTOCOL_ONLN_RVW_DETERM_RECOM ( REVIEW_DETERM_RECOM_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID )
VALUES ( 3, 'Approve', SYSDATE, 'kr', 1, SYS_GUID() );
INSERT INTO PROTOCOL_ONLN_RVW_DETERM_RECOM ( REVIEW_DETERM_RECOM_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID )
VALUES ( 4, 'Expedited Approval', SYSDATE, 'kr', 1, SYS_GUID() );
INSERT INTO PROTOCOL_ONLN_RVW_DETERM_RECOM ( REVIEW_DETERM_RECOM_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID )
VALUES ( 5, 'Grant Exemption', SYSDATE, 'kr', 1, SYS_GUID() );
INSERT INTO PROTOCOL_ONLN_RVW_DETERM_RECOM ( REVIEW_DETERM_RECOM_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID )
VALUES ( 6, 'Expedited Approval', SYSDATE, 'kr', 1, SYS_GUID() );
INSERT INTO PROTOCOL_ONLN_RVW_DETERM_RECOM ( REVIEW_DETERM_RECOM_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID )
VALUES ( 7, 'Close Administratively', SYSDATE, 'kr', 1, SYS_GUID() );
INSERT INTO PROTOCOL_ONLN_RVW_DETERM_RECOM ( REVIEW_DETERM_RECOM_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID )
VALUES ( 8, 'Terminate', SYSDATE, 'kr', 1, SYS_GUID() );
INSERT INTO PROTOCOL_ONLN_RVW_DETERM_RECOM ( REVIEW_DETERM_RECOM_CD, DESCRIPTION, UPDATE_TIMESTAMP, UPDATE_USER, VER_NBR, OBJ_ID )
VALUES ( 9, 'Disapprove', SYSDATE, 'kr', 1, SYS_GUID() );


CREATE TABLE PROTOCOL_ONLN_RVWS (

	PROTOCOL_ONLN_RVW_ID NUMBER( 12, 0 ) NOT NULL,
	DOCUMENT_NUMBER NUMBER(10) NOT NULL,
	PROTOCOL_ID NUMBER(12,0) NOT NULL,
    SUBMISSION_ID_FK NUMBER(12,0) NOT NULL,
    COMM_MEMBR_REVIEWER_FK NUMBER( 12, 0 ) NOT NULL,
    PROTOCOL_ONLN_RVW_STATUS_CODE VARCHAR(3) NOT NULL,
    REVIEW_DETERM_RECOM_CD NUMBER( 3,0 ) NULL,
    DATE_REQUESTED DATE NOT NULL,
    DATE_DUE DATE,
    UPDATE_TIMESTAMP DATE NOT NULL,
	UPDATE_USER VARCHAR(60) NOT NULL,
	VER_NBR DECIMAL(8) NOT NULL,
	OBJ_ID VARCHAR(36) NOT NULL

	);


ALTER TABLE PROTOCOL_ONLN_RVWS ADD CONSTRAINT PK_PROTOCOL_ONLN_RVWS PRIMARY KEY ( PROTOCOL_ONLN_RVW_ID );
ALTER TABLE PROTOCOL_ONLN_RVWS ADD CONSTRAINT UQ1_PROTOCOL_ONLN_RVWS UNIQUE ( PROTOCOL_ID, SUBMISSION_ID_FK, COMM_MEMBR_REVIEWER_FK );
ALTER TABLE PROTOCOL_ONLN_RVWS ADD CONSTRAINT FK1_PROTOCOL_ONLN_RVWS FOREIGN KEY ( PROTOCOL_ONLN_RVW_STATUS_CODE ) REFERENCES PROTOCOL_ONLN_RVW_STATUS ( STATUS_CODE );
ALTER TABLE PROTOCOL_ONLN_RVWS ADD CONSTRAINT FK2_PROTOCOL_ONLN_RVWS FOREIGN KEY ( COMM_MEMBR_REVIEWER_FK ) REFERENCES COMM_MEMBERSHIPS ( COMM_MEMBERSHIP_ID );
ALTER TABLE PROTOCOL_ONLN_RVWS ADD CONSTRAINT FK3_PROTOCOL_ONLN_RVWS FOREIGN KEY ( SUBMISSION_ID_FK ) REFERENCES PROTOCOL_SUBMISSION (SUBMISSION_ID);
ALTER TABLE PROTOCOL_ONLN_RVWS ADD CONSTRAINT FK4_PROTOCOL_ONLN_RVWS FOREIGN KEY (PROTOCOL_ID) REFERENCES PROTOCOL (PROTOCOL_ID);
ALTER TABLE PROTOCOL_ONLN_RVWS ADD CONSTRAINT FK5_PROTOCOL_ONLN_RVWS FOREIGN KEY ( REVIEW_DETERM_RECOM_CD ) REFERENCES PROTOCOL_ONLN_RVW_DETERM_RECOM ( REVIEW_DETERM_RECOM_CD );


ALTER TABLE COMM_SCHEDULE_MINUTES ADD ( 
	PROTOCOL_ONLN_RVW_FK NUMBER( 12, 0 ) NULL 
	);
	
ALTER TABLE COMM_SCHEDULE_MINUTES ADD CONSTRAINT FK_COMM_SCHEDULE_MINUTES_FK4  FOREIGN KEY ( PROTOCOL_ONLN_RVW_FK ) REFERENCES PROTOCOL_ONLN_RVWS ( PROTOCOL_ONLN_RVW_ID );

CREATE TABLE PROTOCOL_ONLN_RVW_DOCUMENT(
DOCUMENT_NUMBER NUMBER(10) NOT NULL,
VER_NBR NUMBER(8,0) DEFAULT 1 NOT NULL,
OBJ_ID VARCHAR2(36) DEFAULT SYS_GUID()  NOT NULL,
UPDATE_TIMESTAMP DATE NOT NULL,
UPDATE_USER VARCHAR2(10) NOT NULL);

/* Primary Key Constraint */
ALTER TABLE PROTOCOL_ONLN_RVW_DOCUMENT
ADD CONSTRAINT PK_PROTOCOL_ONLN_RVW_DOCUMENT
PRIMARY KEY (DOCUMENT_NUMBER);


/* Foreign Key Constraint(s) */ 
ALTER TABLE PROTOCOL_ONLN_RVWS
ADD CONSTRAINT FK6_PROTOCOL_ONLN_RVW_DOCUMENT 
FOREIGN KEY (DOCUMENT_NUMBER) 
REFERENCES PROTOCOL_ONLN_RVW_DOCUMENT (DOCUMENT_NUMBER);

